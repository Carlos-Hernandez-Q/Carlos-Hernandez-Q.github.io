<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Árbol 3D RGB</title>

<style>
body {
    margin: 0;
    background: black;
    height: 100vh;
    font-family: Arial, sans-serif;
    overflow: hidden;
}

/* ESCENA */
.scene {
    width: 100%;
    height: 100%;
    perspective: 1400px;
    position: relative;
    overflow: hidden;
}

/* ÁRBOL */
.tree {
    position: absolute;
    top: 50%;
    left: 50%;
    transform-style: preserve-3d;
}

/* LUCES */
.light {
    position: absolute;
    width: 7px;
    height: 7px;
    border-radius: 50%;
    opacity: 0.15;
    transition: opacity 0.2s;
}
.light.on { opacity: 1; }

/* ESTRELLA */
.star {
    position: absolute;
    width: 48px;
    filter: drop-shadow(0 0 20px gold);
    transform-style: preserve-3d;
    z-index: 5;
}

/* NIEVE */
.snow {
    position: absolute;
    width: 4px;
    height: 4px;
    background: white;
    border-radius: 50%;
    opacity: 0.85;
    pointer-events: none;
}
</style>
</head>

<body>

<div class="scene" id="scene">
    <div class="tree" id="tree"></div>
    <img src="star.png" class="star" id="star">
</div>

<script>
const scene = document.getElementById("scene");
const tree = document.getElementById("tree");
const star = document.getElementById("star");

/* ===== CONFIG ===== */
let scale = 1.35;       // grande por defecto
let rotY = 0;
let rotX = -18;
let hueOffset = 0;
let wave = 0;

/* ===== ÁRBOL ===== */
const ALTURA = 520;
const OFFSET_Y = 120;   // <<< SUBE EL ÁRBOL
const TOTAL_LUCES = 460;
let lights = [];

function crearArbol() {
    tree.innerHTML = "";
    lights = [];

    for (let i = 0; i < TOTAL_LUCES; i++) {
        const l = document.createElement("div");
        l.className = "light";

        const y = (i / TOTAL_LUCES) * ALTURA;
        const r = (ALTURA - y) / 2.6;
        const a = i * 0.32;

        const x = Math.cos(a) * r;
        const z = Math.sin(a) * r;

        l.dataset.y = ALTURA - y;

        l.style.transform = `
            translate3d(${x}px, ${ALTURA - y}px, ${z}px)
        `;

        tree.appendChild(l);
        lights.push(l);
    }
}

crearArbol();

/* ===== NIEVE ===== */
let snowflakes = [];

function crearNieve() {
    for (let i = 0; i < 180; i++) {
        const s = document.createElement("div");
        s.className = "snow";
        resetSnow(s);
        scene.appendChild(s);
        snowflakes.push(s);
    }
}

function resetSnow(s) {
    s.style.left = Math.random() * window.innerWidth + "px";
    s.style.top = -10 + "px";
    s.dataset.speed = 1.5 + Math.random() * 3;
}

crearNieve();

/* ===== TOUCH / MOUSE ===== */
let dragging = false;
let lastX = 0;
let lastDist = 0;

scene.addEventListener("pointerdown", e => {
    dragging = true;
    lastX = e.clientX;
});
scene.addEventListener("pointerup", () => dragging = false);
scene.addEventListener("pointermove", e => {
    if (!dragging) return;
    rotY += (e.clientX - lastX) * 0.3;
    lastX = e.clientX;
});

scene.addEventListener("wheel", e => {
    scale += e.deltaY * -0.001;
    scale = Math.min(Math.max(scale, 0.6), 2.5);
});

scene.addEventListener("touchmove", e => {
    if (e.touches.length === 2) {
        const dx = e.touches[0].clientX - e.touches[1].clientX;
        const dy = e.touches[0].clientY - e.touches[1].clientY;
        const dist = Math.sqrt(dx * dx + dy * dy);

        if (lastDist) {
            scale += (dist - lastDist) * 0.002;
            scale = Math.min(Math.max(scale, 0.6), 2.5);
        }
        lastDist = dist;
    }
});
scene.addEventListener("touchend", () => lastDist = 0);

/* ===== LOOP ===== */
function loop() {

    /* Árbol más arriba */
    tree.style.transform = `
        translate3d(-50%, -50%, 0)
        translateY(-${OFFSET_Y}px)
        scale(${scale})
        rotateX(${rotX}deg)
        rotateY(${rotY}deg)
    `;

    /* Estrella alineada */
    star.style.transform = `
        translate3d(-50%, -${ALTURA / 2 + OFFSET_Y - 8}px, 0)
        scale(${scale})
        rotateY(${rotY}deg)
    `;

    /* ===== ANIMACIÓN DE LUCES (OLA VISIBLE) ===== */
    lights.forEach(l => {
        const y = parseFloat(l.dataset.y);

        const phase = Math.abs(y - wave);
        const on = phase < 40;

        const hue = (y * 1.6 + hueOffset) % 360;
        const color = `hsl(${hue},100%,60%)`;

        l.style.background = color;
        l.style.boxShadow = `0 0 14px ${color}`;
        l.classList.toggle("on", on);
    });

    wave += 12;
    if (wave > ALTURA) wave = 0;

    hueOffset += 3;

    /* Nieve */
    snowflakes.forEach(s => {
        s.style.top = (parseFloat(s.style.top) + Number(s.dataset.speed)) + "px";
        if (parseFloat(s.style.top) > window.innerHeight) resetSnow(s);
    });

    requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
