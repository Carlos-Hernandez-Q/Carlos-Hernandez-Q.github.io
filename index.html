<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Árbol 3D con Nieve</title>

<style>
body {
    margin: 0;
    background: black;
    display: flex;
    height: 100vh;
    font-family: Arial, sans-serif;
    color: white;
}

/* ================= ESCENA ================= */
.scene {
    width: 60%;
    display: flex;
    justify-content: center;
    align-items: center;
    perspective: 900px;
    position: relative;
    overflow: hidden;
}

/* ================= ÁRBOL ================= */
.tree {
    position: relative;
    transform-style: preserve-3d;
}

/* ================= LUCES ================= */
.light {
    position: absolute;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    opacity: 0.2;
    transition: opacity 0.3s;
}

.light.on {
    opacity: 1;
}

/* ================= ESTRELLA ================= */
.star {
    position: absolute;
    width: 36px;
    transform-style: preserve-3d;
    filter: drop-shadow(0 0 15px gold);
    z-index: 5;
}

/* ================= NIEVE ================= */
.snow {
    position: absolute;
    width: 4px;
    height: 4px;
    background: white;
    border-radius: 50%;
    opacity: 0.8;
    pointer-events: none;
}

/* ================= PANEL ================= */
.panel {
    width: 40%;
    padding: 20px;
    background: #0b0b0b;
}

.control {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: #111;
    padding: 8px 10px;
    margin-bottom: 10px;
    border-radius: 6px;
}

.control span {
    width: 80px;
    font-size: 12px;
    color: #aaa;
}

.control input,
.control select {
    flex: 1;
    margin-left: 10px;
}

.btn {
    width: 100%;
    padding: 10px;
    background: #222;
    color: #ffd700;
    border: none;
    border-radius: 6px;
    cursor: pointer;
}
</style>
</head>

<body>

<!-- ================= ESCENA ================= -->
<div class="scene" id="scene">
    <div class="tree" id="tree"></div>
    <img src="star.png" class="star" id="star">
</div>

<!-- ================= PANEL ================= -->
<div class="panel">

    <div class="control">
        <span>Rotar</span>
        <input type="range" min="0" max="360" value="0" id="rot">
    </div>

    <div class="control">
        <span>Tamaño</span>
        <input type="range" min="180" max="360" value="260" id="size">
    </div>

    <div class="control">
        <span>Velocidad</span>
        <input type="range" min="50" max="400" value="150" id="speed">
    </div>

    <div class="control">
        <span>Modo Color</span>
        <select id="colorMode">
            <option value="rgb">RGB</option>
            <option value="fixed">Fijo</option>
            <option value="classic">Clásico</option>
        </select>
    </div>

    <div class="control">
        <span>Color</span>
        <input type="color" value="#ff0000" id="colorPicker">
    </div>

    <button class="btn" id="toggle">ENCENDIDAS</button>

</div>

<script>
const scene = document.getElementById("scene");
const tree = document.getElementById("tree");
const star = document.getElementById("star");

const rot = document.getElementById("rot");
const size = document.getElementById("size");
const speed = document.getElementById("speed");
const toggleBtn = document.getElementById("toggle");
const colorMode = document.getElementById("colorMode");
const colorPicker = document.getElementById("colorPicker");

let lights = [];
let snowflakes = [];
let encendido = true;
let nivel = 0;
let hueOffset = 0;

/* ========== CREAR ÁRBOL ========== */
function crearArbol() {
    tree.innerHTML = "";
    lights = [];

    const altura = size.value;
    const totalLuces = 300;

    for (let i = 0; i < totalLuces; i++) {
        const luz = document.createElement("div");
        luz.className = "light";

        const y = (i / totalLuces) * altura;
        const radio = (altura - y) / 3.5;
        const angulo = i * 0.35;

        const x = Math.cos(angulo) * radio;
        const z = Math.sin(angulo) * radio;

        luz.dataset.y = altura - y;

        luz.style.transform = `
            translate3d(${x}px, ${altura - y}px, ${z}px)
        `;

        tree.appendChild(luz);
        lights.push(luz);
    }
}

crearArbol();

/* ========== NIEVE ========== */
function crearNieve() {
    for (let i = 0; i < 120; i++) {
        const snow = document.createElement("div");
        snow.className = "snow";
        resetSnow(snow);
        scene.appendChild(snow);
        snowflakes.push(snow);
    }
}

function resetSnow(s) {
    s.style.left = Math.random() * scene.clientWidth + "px";
    s.style.top = -10 + "px";
    s.dataset.speed = 1 + Math.random() * 2;
}

crearNieve();

/* ========== ANIMACIÓN NIEVE ========== */
function animarNieve() {
    snowflakes.forEach(s => {
        s.style.top = (parseFloat(s.style.top) + Number(s.dataset.speed)) + "px";
        if (parseFloat(s.style.top) > scene.clientHeight) {
            resetSnow(s);
        }
    });
}

/* ========== LUCES SUBIENDO ========== */
let timer = setInterval(animarLuces, speed.value);

function animarLuces() {
    if (!encendido) return;

    lights.forEach(l => {
        const y = parseFloat(l.dataset.y);
        l.classList.toggle("on", y < nivel);
    });

    nivel += 10;
    if (nivel > size.value) nivel = 0;
}

/* ========== VELOCIDAD ========== */
speed.oninput = () => {
    clearInterval(timer);
    timer = setInterval(animarLuces, speed.value);
};

/* ========== UPDATE GENERAL ========== */
function update() {
    tree.style.transform = `
        rotateX(-20deg)
        rotateY(${rot.value}deg)
    `;

    star.style.transform = `
        translate3d(0px, ${size.value * 0.02}px, 0px)
        rotateY(${rot.value}deg)
    `;

    lights.forEach(l => {
        let color;

        if (colorMode.value === "rgb") {
            const y = parseFloat(l.dataset.y);
            const hue = (y * 1.5 + hueOffset) % 360;
            color = `hsl(${hue},100%,60%)`;
        }
        else if (colorMode.value === "fixed") {
            color = colorPicker.value;
        }
        else {
            const colores = ["red", "green", "blue", "yellow"];
            color = colores[Math.floor(l.dataset.y) % colores.length];
        }

        l.style.background = color;
        l.style.boxShadow = `0 0 10px ${color}`;
    });

    hueOffset++;
    animarNieve();
}

setInterval(update, 30);

/* ========== ENCENDIDO ========== */
toggleBtn.onclick = () => {
    encendido = !encendido;
    toggleBtn.innerText = encendido ? "ENCENDIDAS" : "APAGADAS";
};

/* ========== RECREAR ========== */
size.oninput = crearArbol;
</script>

</body>
</html>
