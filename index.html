<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Árbol 3D con Nieve</title>

<style>
body {
    margin: 0;
    background: black;
    height: 100vh;
    font-family: Arial, sans-serif;
    color: white;
    display: flex;
    flex-direction: column;
}


/* ================= ESCENA ================= */
.scene {
    flex: 1;
    position: relative;
    perspective: 1200px;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;   /* ← CLAVE */
}

/* ================= ÁRBOL ================= */
.tree {
    position: relative;
    transform-style: preserve-3d;
}

/* ================= LUCES ================= */
.light {
    position: absolute;
    width: 7px;
    height: 7px;
    border-radius: 50%;
    opacity: 0.25;
}

.light.on {
    opacity: 1;
}

/* ================= ESTRELLA ================= */
.star {
    position: absolute;
    width: 48px;
    filter: drop-shadow(0 0 20px gold);
    transform-style: preserve-3d;
    z-index: 5;
}

/* ================= NIEVE ================= */
.snow {
    position: absolute;
    width: 4px;
    height: 4px;
    background: white;
    border-radius: 50%;
    opacity: 0.8;
    pointer-events: none;
}

/* ================= PANEL ================= */
.panel {
    background: #0b0b0b;
    padding: 12px;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 10px;
}

.control {
    background: #111;
    padding: 6px 8px;
    border-radius: 6px;
    display: flex;
    align-items: center;
}

.control span {
    font-size: 11px;
    color: #aaa;
    width: 70px;
}

.control input,
.control select {
    flex: 1;
}

.btn {
    grid-column: 1 / -1;
    padding: 10px;
    background: #222;
    color: #ffd700;
    border: none;
    border-radius: 6px;
    cursor: pointer;
}
</style>
</head>

<body>

<!-- ================= ESCENA ================= -->
<div class="scene" id="scene">
    <div class="tree" id="tree"></div>
    <img src="star.png" class="star" id="star">
</div>

<!-- ================= PANEL ================= -->
<div class="panel">

    <div class="control">
        <span>Rotar</span>
        <input type="range" min="0" max="360" value="0" id="rot">
    </div>

    <div class="control">
        <span>Tamaño</span>
        <input type="range" min="300" max="600" value="480" id="size">
    </div>

    <div class="control">
        <span>Velocidad</span>
        <input type="range" min="50" max="400" value="120" id="speed">
    </div>

    <div class="control">
        <span>Modo</span>
        <select id="colorMode">
            <option value="rgb">RGB</option>
            <option value="fixed">Fijo</option>
            <option value="classic">Clásico</option>
        </select>
    </div>

    <div class="control">
        <span>Color</span>
        <input type="color" value="#ff0000" id="colorPicker">
    </div>

    <button class="btn" id="toggle">ENCENDIDAS</button>

</div>

<script>
const scene = document.getElementById("scene");
const tree = document.getElementById("tree");
const star = document.getElementById("star");

const rot = document.getElementById("rot");
const size = document.getElementById("size");
const speed = document.getElementById("speed");
const toggleBtn = document.getElementById("toggle");
const colorMode = document.getElementById("colorMode");
const colorPicker = document.getElementById("colorPicker");

let lights = [];
let snowflakes = [];
let encendido = true;
let nivel = 0;
let hueOffset = 0;

/* ========== CREAR ÁRBOL ========== */
function crearArbol() {
    tree.innerHTML = "";
    lights = [];

    const altura = size.value;
    const totalLuces = 420;

    for (let i = 0; i < totalLuces; i++) {
        const luz = document.createElement("div");
        luz.className = "light";

        const y = (i / totalLuces) * altura;
        const radio = (altura - y) / 2.8;
        const angulo = i * 0.32;

        const x = Math.cos(angulo) * radio;
        const z = Math.sin(angulo) * radio;

        luz.dataset.y = altura - y;

        luz.style.transform = `
            translate3d(${x}px, ${altura - y}px, ${z}px)
        `;

        tree.appendChild(luz);
        lights.push(luz);
    }
}

crearArbol();

/* ========== NIEVE ========== */
function crearNieve() {
    for (let i = 0; i < 160; i++) {
        const s = document.createElement("div");
        s.className = "snow";
        resetSnow(s);
        scene.appendChild(s);
        snowflakes.push(s);
    }
}

function resetSnow(s) {
    s.style.left = Math.random() * scene.clientWidth + "px";
    s.style.top = -10 + "px";
    s.dataset.speed = 1 + Math.random() * 2.5;
}

crearNieve();

/* ========== LUCES SUBEN ========== */
let timer = setInterval(animarLuces, speed.value);

function animarLuces() {
    if (!encendido) return;

    lights.forEach(l => {
        const y = parseFloat(l.dataset.y);
        l.classList.toggle("on", y < nivel);
    });

    nivel += 12;
    if (nivel > size.value) nivel = 0;
}

/* ========== UPDATE GENERAL ========== */
function update() {
    tree.style.transform = `
        translateY(-${size.value / 2}px)
        rotateX(-18deg)
        rotateY(${rot.value}deg)
    `;

    star.style.transform = `
        translate3d(0px, -${size.value / 2 - 10}px, 0px)
        rotateY(${rot.value}deg)
    `;

    lights.forEach(l => {
        let color;

        if (colorMode.value === "rgb") {
            const y = parseFloat(l.dataset.y);
            const hue = (y * 1.4 + hueOffset) % 360;
            color = `hsl(${hue},100%,60%)`;
        } else if (colorMode.value === "fixed") {
            color = colorPicker.value;
        } else {
            const colores = ["red", "green", "blue", "yellow"];
            color = colores[Math.floor(l.dataset.y / 30) % colores.length];
        }

        l.style.background = color;
        l.style.boxShadow = `0 0 12px ${color}`;
    });

    hueOffset++;
    animarNieve();
}

setInterval(update, 30);

/* ========== CONTROLES ========== */
speed.oninput = () => {
    clearInterval(timer);
    timer = setInterval(animarLuces, speed.value);
};

toggleBtn.onclick = () => {
    encendido = !encendido;
    toggleBtn.innerText = encendido ? "ENCENDIDAS" : "APAGADAS";
};

size.oninput = crearArbol;
</script>

</body>
</html>
